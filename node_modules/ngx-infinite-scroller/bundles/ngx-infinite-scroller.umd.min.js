!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("is-number"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-infinite-scroller",["exports","@angular/core","rxjs","is-number","rxjs/operators"],e):e(t["ngx-infinite-scroller"]={},t.ng.core,t.rxjs,t.isNumber,t.rxjs.operators)}(this,function(t,n,l,i,s){"use strict";i=i&&i.hasOwnProperty("default")?i["default"]:i;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function e(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var o=function(){function t(){}return Object.defineProperty(t.prototype,"scrollTop",{get:function(){return this._el.nativeElement.scrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollHeight",{get:function(){return this._el.nativeElement.scrollHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientHeight",{get:function(){return this._el.nativeElement.clientHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initMode",{get:function(){return this._initMode},set:function(t){this._initMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollStreamActive",{get:function(){return this._scrollStreamActive},set:function(t){this._scrollStreamActive=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousScrollPositionpUpdated",{get:function(){return this._previousScrollPositionpUpdated},set:function(t){this._previousScrollPositionpUpdated=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousScrollTop",{get:function(){return this._previousScrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previousScrollHeight",{get:function(){return this._previousScrollHeight},enumerable:!0,configurable:!0}),t.prototype.setup=function(t){this._el=t.el,this._initMode=t.initMode,this._scrollStreamActive=t.scrollStreamActive,this._previousScrollPositionpUpdated=t.previousScrollPositionpUpdated,this.updatePreviousScrollTop(),this.updatePreviousScrollHeight()},t.prototype.updatePreviousScrollTop=function(){this._previousScrollTop=this._el.nativeElement.scrollTop},t.prototype.updatePreviousScrollHeight=function(){this._previousScrollHeight=this._el.nativeElement.scrollHeight},t}(),c="DEFAULT",p="TOP",u="MIDDLE",a="BOTTOM",h=function b(){},g=function(){function t(t,e){this.directive=t,this.state=e}return t.prototype.wasScrolledDown=function(t,e){return t.scrollTop<e.scrollTop},t.prototype.wasScrolledUp=function(t,e){return!this.wasScrolledDown(t,e)},t.prototype.isScrollDownEnough=function(t,e){return(t.scrollTop+t.clientHeight)/t.scrollHeight>e/100},t.prototype.isScrollUpEnough=function(t,e){return t.scrollTop/t.scrollHeight<e/100},t.prototype.getInitialScrollPositionValue=function(t){var e=this.directive.initialScrollPosition;if(i(e))return Number(e);var o=this.getInitialScrollPositions();return e===c?o[t]:o[e]},t.prototype.getInitialScrollPositions=function(){var t,e=this.state,o=e.scrollHeight,i=e.clientHeight;return(t={})[p]=0,t[u]=o/2-i/2,t[a]=o,t},t}(),f=function(o){function t(t,e){return o.call(this,t,e)||this}return e(t,o),t.prototype.scrollDirectionChanged=function(t){var e=this;return t.pipe(s.filter(function(t){return o.prototype.wasScrolledUp.call(e,t[0],t[1])}))},t.prototype.scrollRequestZoneChanged=function(t){var e=this;return t.pipe(s.filter(function(t){return o.prototype.isScrollUpEnough.call(e,t[1],e.directive.scrollUpPercentilePositionTrigger)}))},t.prototype.askForUpdate=function(){this.directive.onScrollUp.next()},t.prototype.setInitialScrollPosition=function(){var t=o.prototype.getInitialScrollPositionValue.call(this,a);this.directive.scrollTo(t)},t.prototype.setPreviousScrollPosition=function(){var t=this.state.previousScrollTop+(this.state.scrollHeight-this.state.previousScrollHeight);this.directive.scrollTo(t)},t}(g),d=function(o){function t(t,e){return o.call(this,t,e)||this}return e(t,o),t.prototype.scrollDirectionChanged=function(t){var e=this;return t.pipe(s.filter(function(t){return o.prototype.wasScrolledDown.call(e,t[0],t[1])}))},t.prototype.scrollRequestZoneChanged=function(t){var e=this;return t.pipe(s.filter(function(t){return o.prototype.isScrollDownEnough.call(e,t[1],e.directive.scrollDownPercentilePositionTrigger)}))},t.prototype.askForUpdate=function(){this.directive.onScrollDown.next()},t.prototype.setInitialScrollPosition=function(){var t=o.prototype.getInitialScrollPositionValue.call(this,p);this.directive.scrollTo(t)},t.prototype.setPreviousScrollPosition=function(){var t=this.state.previousScrollTop;this.directive.scrollTo(t)},t}(g),y=function(o){function t(t,e){return o.call(this,t,e)||this}return e(t,o),t.prototype.scrollDirectionChanged=function(t){return t},t.prototype.scrollRequestZoneChanged=function(t){var e=this;return t.pipe(s.filter(function(t){return o.prototype.isScrollUpEnough.call(e,t[1],e.directive.scrollUpPercentilePositionTrigger)||o.prototype.isScrollDownEnough.call(e,t[1],e.directive.scrollDownPercentilePositionTrigger)}),s.tap(function(t){e.scrolledUp=o.prototype.wasScrolledUp.call(e,t[0],t[1])}))},t.prototype.askForUpdate=function(){this.scrolledUp?this.directive.onScrollUp.next():this.directive.onScrollDown.next()},t.prototype.setInitialScrollPosition=function(){var t=o.prototype.getInitialScrollPositionValue.call(this,u);this.directive.scrollTo(t)},t.prototype.setPreviousScrollPosition=function(){var t;t=this.scrolledUp?this.state.previousScrollTop+(this.state.scrollHeight-this.state.previousScrollHeight):this.state.previousScrollTop,this.directive.scrollTo(t)},t}(g),v=function(){function t(t,e){this.directive=t,this.state=e,this.DEFAULT_REQUEST_TIMEOUT=3e4}return t.prototype.start=function(){var t=this;this.listener=window.requestAnimationFrame(this.listen.bind(this)),this.httpRequestTimeout||(this.httpRequestTimeout=setTimeout(function(){t.stopIfRequestTimeout()},this.DEFAULT_REQUEST_TIMEOUT))},t.prototype.stop=function(){window.cancelAnimationFrame(this.listener),clearTimeout(this.httpRequestTimeout),this.httpRequestTimeout=null},t.prototype.listen=function(){this.state.previousScrollHeight!==this.state.scrollHeight?(this.stop(),this.directive.onScrollbarHeightChanged()):this.start()},t.prototype.stopIfRequestTimeout=function(){this.state.previousScrollPositionpUpdated||this.stop()},t}(),S=function(r){function t(t,e,o){var i=r.call(this)||this;return i.el=t,i.renderer=e,i.state=o,i.strategy="scrollingToBottom",i.initialScrollPosition=c,i.scrollbarAnimationInterval=100,i.scrollDebounceTimeAfterScrollHeightChanged=50,i.scrollDebounceTimeAfterDOMMutationOnInit=1e3,i.scrollUpPercentilePositionTrigger=2,i.scrollDownPercentilePositionTrigger=98,i.onScrollUp=new n.EventEmitter,i.onScrollDown=new n.EventEmitter,i.scrollHeightChanged=new l.Subject,i.domMutationEmitter=new l.Subject,i.state.setup({el:t,initMode:!0,scrollStreamActive:!0,previousScrollPositionpUpdated:!1}),i}return e(t,r),Object.defineProperty(t.prototype,"scrollPairChanged",{get:function(){var t=this;if(this.scrollChanged)return this.scrollChanged.pipe(s.takeWhile(function(){return t.state.scrollStreamActive}),s.map(function(t){return{scrollHeight:t.target.scrollHeight,scrollTop:t.target.scrollTop,clientHeight:t.target.clientHeight}}),s.pairwise(),s.debounceTime(this.scrollbarAnimationInterval))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollDirectionChanged",{get:function(){return this.scrollingStrategy.scrollDirectionChanged(this.scrollPairChanged)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollRequestZoneChanged",{get:function(){var t=this;return this.scrollingStrategy.scrollRequestZoneChanged(this.scrollDirectionChanged).pipe(s.tap(function(){t.state.updatePreviousScrollTop(),t.state.updatePreviousScrollHeight(),t.state.previousScrollPositionpUpdated=!1,t.scrollHeightListener.start()}))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.useStrategy(),this.useScrollHeightListener(),this.registerScrollEventHandler(),this.registerMutationObserver(),this.registerInitialScrollPostionHandler(),this.registerPreviousScrollPositionHandler()},t.prototype.ngAfterViewInit=function(){this.registerScrollSpy()},t.prototype.ngOnDestroy=function(){this.domMutationObserver.disconnect()},t.prototype.scrollTo=function(t){this.state.scrollStreamActive=!1,this.renderer.setProperty(this.el.nativeElement,"scrollTop",t),this.state.scrollStreamActive=!0},t.prototype.onScrollbarHeightChanged=function(){this.scrollHeightChanged.next()},t.prototype.registerScrollEventHandler=function(){this.scrollChanged=l.fromEvent(this.el.nativeElement,"scroll")},t.prototype.registerMutationObserver=function(){var e=this;this.domMutationObserver=new MutationObserver(function(t){e.domMutationEmitter.next(t)});this.domMutationObserver.observe(this.el.nativeElement,{attributes:!0,childList:!0,characterData:!0})},t.prototype.registerInitialScrollPostionHandler=function(){var t=this;this.domMutationEmitter.pipe(s.takeWhile(function(){return t.state.initMode}),s.debounceTime(this.scrollDebounceTimeAfterDOMMutationOnInit)).subscribe(function(){t.scrollingStrategy.setInitialScrollPosition(),t.state.initMode=!1})},t.prototype.registerPreviousScrollPositionHandler=function(){var t=this;l.zip(this.scrollRequestZoneChanged,this.scrollHeightChanged).pipe(s.skipWhile(function(){return t.state.initMode}),s.debounceTime(this.scrollDebounceTimeAfterScrollHeightChanged)).subscribe(function(){t.scrollingStrategy.setPreviousScrollPosition(),t.state.previousScrollPositionpUpdated=!0})},t.prototype.registerScrollSpy=function(){var t=this;this.scrollRequestZoneChanged.subscribe(function(){t.scrollingStrategy.askForUpdate()})},t.prototype.useStrategy=function(){switch(this.strategy){case"scrollingToBoth":this.scrollingStrategy=new y(this,this.state);break;case"scrollingToTop":this.scrollingStrategy=new f(this,this.state);break;case"scrollingToBottom":default:this.scrollingStrategy=new d(this,this.state)}},t.prototype.useScrollHeightListener=function(){this.scrollHeightListener=new v(this,this.state)},t.decorators=[{type:n.Directive,args:[{selector:"[ngxInfiniteScroller]"}]}],t.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2},{type:o}]},t.propDecorators={strategy:[{type:n.Input}],initialScrollPosition:[{type:n.Input}],scrollbarAnimationInterval:[{type:n.Input}],scrollDebounceTimeAfterScrollHeightChanged:[{type:n.Input}],scrollDebounceTimeAfterDOMMutationOnInit:[{type:n.Input}],scrollUpPercentilePositionTrigger:[{type:n.Input}],scrollDownPercentilePositionTrigger:[{type:n.Input}],onScrollUp:[{type:n.Output}],onScrollDown:[{type:n.Output}]},t}(h),P=function(){function t(){}return t.decorators=[{type:n.NgModule,args:[{declarations:[S],imports:[],exports:[S],providers:[o],bootstrap:[]}]}],t}();t.NgxInfiniteScrollerModule=P,t.ɵb=h,t.ɵc=o,t.ɵa=S,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-infinite-scroller.umd.min.js.map